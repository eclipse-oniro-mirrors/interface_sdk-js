/*
 * Copyright (C) 2021 Huawei Device Co., Ltd.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * @file
 * @kit PerformanceAnalysisKit
 */

/**
 * Provides interfaces to trace a task for performance measure, the logs can be capture by the
 * bytrace cmdline available on the device.
 *
 * <p>This interfaces trace the start, end, and value changes of key processes that last for at least 3 ms.
 *
 * <p>Example:
 * Track the beginning of a context:
 * <pre>{@code
 * hiTraceMeter.startTrace("checkName", 111);
 * }</pre>
 * Track the end of a context:
 * <pre>{@code
 * hiTraceMeter.finishTrace("checkName", 111);
 * }</pre>
 * To trace the number of layers, which is 3:
 * <pre>{@code
 * hiTraceMeter.traceByValue("curLayer", 3);
 * }</pre>
 *
 * <p>Each {@code startTrace} matches one {@code finishTrace}, and they must have the same name
 * and taskId.
 *
 * @namespace hiTraceMeter
 * @syscap SystemCapability.HiviewDFX.HiTrace
 * @since 8
 */
/**
 * Provides interfaces to trace a task for performance measure, the logs can be capture by the
 * hitrace cmdline on the device.
 *
 * <p>This interfaces trace the start, end, and value changes of key processes that last for at least 3 ms.
 *
 * <p>Example:
 * Track the beginning of a context:
 * <pre>{@code
 * hiTraceMeter.startAsyncTrace(hiTraceMeter.HiTraceOutputLevel.COMMERCIAL, "checkName", 111, "test", "key=value");
 * }</pre>
 * Track the end of a context:
 * <pre>{@code
 * hiTraceMeter.finishAsyncTrace(hiTraceMeter.HiTraceOutputLevel.COMMERCIAL, "checkName", 111);
 * }</pre>
 * To trace the number of layers, which is 3:
 * <pre>{@code
 * hiTraceMeter.traceByValue(hiTraceMeter.HiTraceOutputLevel.COMMERCIAL, "curLayer", 3);
 * }</pre>
 *
 * <p>Each {@code startTrace} matches one {@code finishTrace}, and they must have the same name
 * and taskId.
 *
 * <p>Each {@code startSyncTrace} matches one {@code finishSyncTrace}, and they must have the same
 * level and name.
 *
 * <p>Each {@code startAsyncTrace} matches one {@code finishAsyncTrace}, and they must have the same
 * level, name and taskId.
 *
 * @namespace hiTraceMeter
 * @syscap SystemCapability.HiviewDFX.HiTrace
 * @atomicservice
 * @since 19
 */
/**
 * Provides interfaces to trace a task for performance measure, the logs can be capture by the
 * hitrace cmdline on the device.
 *
 * <p>This interfaces trace the start, end, and value changes of key processes that last for at least 3 ms.
 *
 * <p>Example:
 * Track the beginning of a context:
 * <pre>{@code
 * hiTraceMeter.startAsyncTrace(hiTraceMeter.HiTraceOutputLevel.COMMERCIAL, "checkName", 111, "test", "key=value");
 * }</pre>
 * Track the end of a context:
 * <pre>{@code
 * hiTraceMeter.finishAsyncTrace(hiTraceMeter.HiTraceOutputLevel.COMMERCIAL, "checkName", 111);
 * }</pre>
 * To trace the number of layers, which is 3:
 * <pre>{@code
 * hiTraceMeter.traceByValue(hiTraceMeter.HiTraceOutputLevel.COMMERCIAL, "curLayer", 3);
 * }</pre>
 *
 * <p>Each {@code startTrace} matches one {@code finishTrace}, and they must have the same name
 * and taskId.
 *
 * <p>Each {@code startSyncTrace} matches one {@code finishSyncTrace}, and they must have the same
 * level and name.
 *
 * <p>Each {@code startAsyncTrace} matches one {@code finishAsyncTrace}, and they must have the same
 * level, name and taskId.
 *
 * @namespace hiTraceMeter
 * @syscap SystemCapability.HiviewDFX.HiTrace
 * @crossplatform
 * @atomicservice
 * @since 20 dynamic
 * @since 23 static
 */
declare namespace hiTraceMeter {

  /**
   * Enumerates the HiTrace output levels. The output level threshold system parameter determines
   * the minimum output trace.
   *
   * @enum { int }
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @atomicservice
   * @since 19
   */
  /**
   * Enumerates the HiTrace output levels. The output level threshold system parameter determines
   * the minimum output trace.
   *
   * @enum { int }
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @crossplatform
   * @atomicservice
   * @since 20 dynamic
   * @since 23 static
   */
  enum HiTraceOutputLevel {
    /**
     * Ouput level only for debug usage.
     *
     * @syscap SystemCapability.HiviewDFX.HiTrace
     * @atomicservice
     * @since 19
     */
    /**
     * Ouput level only for debug usage.
     *
     * @syscap SystemCapability.HiviewDFX.HiTrace
     * @crossplatform
     * @atomicservice
     * @since 20 dynamic
     * @since 23 static
     */
    DEBUG = 0,

    /**
     * Output level for log version usage.
     *
     * @syscap SystemCapability.HiviewDFX.HiTrace
     * @atomicservice
     * @since 19
     */
    /**
     * Output level for log version usage.
     *
     * @syscap SystemCapability.HiviewDFX.HiTrace
     * @crossplatform
     * @atomicservice
     * @since 20 dynamic
     * @since 23 static
     */
    INFO = 1,

    /**
     * Output level for log version usage, with higher priority than INFO.
     *
     * @syscap SystemCapability.HiviewDFX.HiTrace
     * @atomicservice
     * @since 19
     */
    /**
     * Output level for log version usage, with higher priority than INFO.
     *
     * @syscap SystemCapability.HiviewDFX.HiTrace
     * @crossplatform
     * @atomicservice
     * @since 20 dynamic
     * @since 23 static
     */
    CRITICAL = 2,

    /**
     * Output level for nolog version usage.
     *
     * @syscap SystemCapability.HiviewDFX.HiTrace
     * @atomicservice
     * @since 19
     */
    /**
     * Output level for nolog version usage.
     *
     * @syscap SystemCapability.HiviewDFX.HiTrace
     * @crossplatform
     * @atomicservice
     * @since 20 dynamic
     * @since 23 static
     */
    COMMERCIAL = 3,

    /**
     * Output level range limit.
     *
     * @syscap SystemCapability.HiviewDFX.HiTrace
     * @atomicservice
     * @since 19
     */
    /**
     * Output level range limit.
     *
     * @syscap SystemCapability.HiviewDFX.HiTrace
     * @crossplatform
     * @atomicservice
     * @since 20 dynamic
     * @since 23 static
     */
    MAX = COMMERCIAL
  }

  /**
   * Records a trace marking it as the start of a task, can with the expected completion time between
   * startTrace and finishTrace.
   *
   * This method is invoked at the start of a transaction to indicate that a task has started, whose name
   * is specified by {@code name}, and the taskId is used to distinguish the tasks. It must be followed by
   * {@link #finishTrace}, the name and taskId need to be the same.
   *
   * @param { string } name Indicates the task name.
   * @param { int } taskId The unique id used to distinguish the tasks and match with the id in follow finishTrace.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @since 8
   */
  /**
   * Records a trace marking it as the start of a task, can with the expected completion time between
   * startTrace and finishTrace.
   *
   * This method is invoked at the start of a transaction to indicate that a task has started, whose name
   * is specified by {@code name}, and the taskId is used to distinguish the tasks. It must be followed by
   * {@link #finishTrace}, the name and taskId need to be the same.
   *
   * @param { string } name Indicates the task name.
   * @param { int } taskId The unique id used to distinguish the tasks and match with the id in follow finishTrace.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @atomicservice
   * @since 19
   */
  /**
   * Records a trace marking it as the start of a task, can with the expected completion time between
   * startTrace and finishTrace.
   *
   * This method is invoked at the start of a transaction to indicate that a task has started, whose name
   * is specified by {@code name}, and the taskId is used to distinguish the tasks. It must be followed by
   * {@link #finishTrace}, the name and taskId need to be the same.
   *
   * @param { string } name Indicates the task name.
   * @param { int } taskId The unique id used to distinguish the tasks and match with the id in follow finishTrace.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @crossplatform
   * @atomicservice
   * @since 20 dynamic
   * @since 23 static
   */
  function startTrace(name: string, taskId: int): void;

  /**
   * Records a trace and marks it as the end of a task.
   *
   * This method is invoked at the end of a transaction to indicate that a task has ended, whose name
   * is specified by {@code name}. This method must be invoked after the the startTrace.
   *
   * @param { string } name Indicates the task name. It must be the same with the {@code name} of startTrace.
   * @param { int } taskId The unique id used to distinguish the tasks and must be the same with the .
   *     {@code taskId} of startTrace.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @since 8
   */
  /**
   * Records a trace and marks it as the end of a task.
   *
   * This method is invoked at the end of a transaction to indicate that a task has ended, whose name
   * is specified by {@code name}. This method must be invoked after {@link #startTrace}.
   *
   * @param { string } name Indicates the task name. It must be the same with the {@code name} of startTrace.
   * @param { int } taskId The unique id used to distinguish the tasks and must be the same with the
   *     {@code taskId} of startTrace.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @atomicservice
   * @since 19
   */
  /**
   * Records a trace and marks it as the end of a task.
   *
   * This method is invoked at the end of a transaction to indicate that a task has ended, whose name
   * is specified by {@code name}. This method must be invoked after {@link #startTrace}.
   *
   * @param { string } name Indicates the task name. It must be the same with the {@code name} of startTrace.
   * @param { int } taskId The unique id used to distinguish the tasks and must be the same with the
   *     {@code taskId} of startTrace.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @crossplatform
   * @atomicservice
   * @since 20 dynamic
   * @since 23 static
   */
  function finishTrace(name: string, taskId: int): void;

  /**
   * Records a trace for generating a count, such as clock pulse and the number of layers.
   *
   * @param { string } name Indicates the name used to identify the count.
   * @param { long } count Indicates the number of the count.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @since 8
   */
  /**
   * Records a trace for generating a count, such as clock pulse and the number of layers.
   *
   * @param { string } name Indicates the name used to identify the count.
   * @param { long } count Indicates the number of the count.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @atomicservice
   * @since 19
   */
  /**
   * Records a trace for generating a count, such as clock pulse and the number of layers.
   *
   * @param { string } name Indicates the name used to identify the count.
   * @param { long } count Indicates the number of the count.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @crossplatform
   * @atomicservice
   * @since 20 dynamic
   * @since 23 static
   */
  function traceByValue(name: string, count: long): void;

  /**
   * Records a trace marking it as the start of a task.
   *
   * This method is invoked at the start of a transaction to indicate that a task has started, whose name
   * is specified by {@code name}, and the taskId is used to distinguish the tasks. It must be followed by
   * {@link #finishSyncTrace}, called by the same thread with the same level.
   *
   * @param { HiTraceOutputLevel } level Indicates trace output priority level.
   * @param { string } name Indicates the task name.
   * @param { string } [customArgs] Indicates key=value pair to be output in trace; multiple pairs should use comma
   * as separator.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @atomicservice
   * @since 19
   */
  /**
   * Records a trace marking it as the start of a task.
   *
   * This method is invoked at the start of a transaction to indicate that a task has started, whose name
   * is specified by {@code name}, and the taskId is used to distinguish the tasks. It must be followed by
   * {@link #finishSyncTrace}, called by the same thread with the same level.
   *
   * @param { HiTraceOutputLevel } level Indicates trace output priority level.
   * @param { string } name Indicates the task name.
   * @param { string } [customArgs] Indicates key=value pair to be output in trace; multiple pairs should use comma
   * as separator.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @crossplatform
   * @atomicservice
   * @since 20 dynamic
   * @since 23 static
   */
  function startSyncTrace(level: HiTraceOutputLevel, name: string, customArgs?: string): void;

  /**
   * Records a trace and marks it as the end of a task.
   *
   * This method is invoked at the end of a transaction to indicate that the nearest running task tracked by
   * startSyncTrace that has yet to be marked by finishSyncTrace, has ended.
   * This method must be invoked after {@link #startSyncTrace}, called by the same thread with the same level.
   *
   * @param { HiTraceOutputLevel } level Indicates trace output priority level.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @atomicservice
   * @since 19
   */
  /**
   * Records a trace and marks it as the end of a task.
   *
   * This method is invoked at the end of a transaction to indicate that the nearest running task tracked by
   * startSyncTrace that has yet to be marked by finishSyncTrace, has ended.
   * This method must be invoked after {@link #startSyncTrace}, called by the same thread with the same level.
   *
   * @param { HiTraceOutputLevel } level Indicates trace output priority level.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @crossplatform
   * @atomicservice
   * @since 20 dynamic
   * @since 23 static
   */
  function finishSyncTrace(level: HiTraceOutputLevel): void;

  /**
   * Records a trace marking it as the start of a task.
   *
   * This method is invoked at the start of a transaction to indicate that a task has started, whose name
   * is specified by {@code name}, and the taskId is used to distinguish the tasks. It must be followed by a
   * corresponding {@link #finishAsyncTrace}, with the same level, name, and taskId.
   *
   * @param { HiTraceOutputLevel } level Indicates trace output priority level.
   * @param { string } name Indicates the task name.
   * @param { int } taskId The unique id used to distinguish the task and match with the id of the
   *     corresponding finishAsyncTrace.
   * @param { string } customCategory Indicates the label to aggregate asynchronous task display.
   * @param { string } [customArgs] Indicates key=value pair to be output in trace; multiple pairs should use comma
   *     as Separator.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @atomicservice
   * @since 19
   */
  /**
   * Records a trace marking it as the start of a task.
   *
   * This method is invoked at the start of a transaction to indicate that a task has started, whose name
   * is specified by {@code name}, and the taskId is used to distinguish the tasks. It must be followed by a
   *     corresponding {@link #finishAsyncTrace}, with the same level, name, and taskId.
   *
   * @param { HiTraceOutputLevel } level Indicates trace output priority level.
   * @param { string } name Indicates the task name.
   * @param { int } taskId The unique id used to distinguish the task and match with the id of the
   *     corresponding finishAsyncTrace.
   * @param { string } customCategory Indicates the label to aggregate asynchronous task display.
   * @param { string } [customArgs] Indicates key=value pair to be output in trace; multiple pairs should use comma
   *     as Separator.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @crossplatform
   * @atomicservice
   * @since 20 dynamic
   * @since 23 static
   */
  function startAsyncTrace(level: HiTraceOutputLevel, name: string, taskId: int, customCategory: string,
      customArgs?: string): void;

  /**
   * Records a trace and marks it as the end of a task.
   *
   * This method is invoked at the end of a transaction to indicate that a task has ended, whose name is specified
   * by {@code name}. This method must be invoked after {@link #startAsyncTrace}, with the same level, name,
   * and taskId. It is not required to be invoked by the same thread calling startAsyncTrace.
   *
   * @param { HiTraceOutputLevel } level Indicates trace output priority level.
   * @param { string } name Indicates the task name.
   * @param { int } taskId The unique id used to distinguish the task and match with the id of the corresponding
   *     startAsyncTrace.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @atomicservice
   * @since 19
   */
  /**
   * Records a trace and marks it as the end of a task.
   *
   * This method is invoked at the end of a transaction to indicate that a task has ended, whose name is specified
   * by {@code name}. This method must be invoked after {@link #startAsyncTrace}, with the same level, name,
   * and taskId. It is not required to be invoked by the same thread calling startAsyncTrace.
   *
   * @param { HiTraceOutputLevel } level Indicates trace output priority level.
   * @param { string } name Indicates the task name.
   * @param { int } taskId The unique id used to distinguish the task and match with the id of the corresponding
   *     startAsyncTrace.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @crossplatform
   * @atomicservice
   * @since 20 dynamic
   * @since 23 static
   */
  function finishAsyncTrace(level: HiTraceOutputLevel, name: string, taskId: int): void;

  /**
   * Records a trace for generating a count, such as clock pulse and the number of layers.
   *
   * @param { HiTraceOutputLevel } level Indicates trace output priority level.
   * @param { string } name Indicates the name used to identify the count.
   * @param { long } count Indicates the number of the count.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @atomicservice
   * @since 19
   */
  /**
   * Records a trace for generating a count, such as clock pulse and the number of layers.
   *
   * @param { HiTraceOutputLevel } level Indicates trace output priority level.
   * @param { string } name Indicates the name used to identify the count.
   * @param { long } count Indicates the number of the count.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @crossplatform
   * @atomicservice
   * @since 20 dynamic
   * @since 23 static
   */
  function traceByValue(level: HiTraceOutputLevel, name: string, count: long): void;

  /**
   * Return whether the current process is allowed to output trace.
   *
   * @returns { boolean } The status of whether the current process is allowed to output trace.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @atomicservice
   * @since 19
   */
  /**
   * Return whether the current process is allowed to output trace.
   *
   * @returns { boolean } The status of whether the current process is allowed to output trace.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @crossplatform
   * @atomicservice
   * @since 20 dynamic
   * @since 23 static
   */
  function isTraceEnabled(): boolean;

  /**
   * Defines the callback type used in trace status switch event.
   * The value of traceStatus indicates the current trace status.
   *
   * @typedef { function } TraceEventListener
   * @param { boolean } traceStatus The current trace status, true for open, false for close.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @crossplatform
   * @atomicservice
   * @since 22 dynamic
   * @since 23 static
   */
  type TraceEventListener = (traceStatus: boolean) => void;

  /**
   * Register trace switch notification callback.
   *
   * Register a callback function to execute specific trace-related behavior when trace
   * status is changed. The current status will be passed as 0 for off or 1 for on as callback function
   * paramter representing current trace status. The maximum number of registered callback functions is 10.
   *
   * @param { TraceEventListener } callback - The callback function to be invoked when trace status is changed.
   * @returns { int } The callback registeration status.
   *     >= 0: Successfully registered and callback index used for unregister.
   *     -1: Reaches max number of callback functions.
   *     -2: Invalid parameter.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @crossplatform
   * @atomicservice
   * @since 22 dynamic
   * @since 23 static
   */
  function registerTraceListener(callback: TraceEventListener): int;

  /**
   * Unregister trace switch notification callback.
   *
   * Unregister the callback function registeration for trace switch notification
   * with provided registered callback function index.
   *
   * @param { int } index - The callback function index to be unregistered.
   * @returns { int } The callback unregisteration status.
   *     0: Success.
   *     -1: Callback function with target index has not been registered.
   *     -2: Invalid index range.
   * @syscap SystemCapability.HiviewDFX.HiTrace
   * @crossplatform
   * @atomicservice
   * @since 22 dynamic
   * @since 23 static
   */
  function unregisterTraceListener(index: int): int;
}

export default hiTraceMeter;
